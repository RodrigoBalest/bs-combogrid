/*! Bootstrap Combogrid - v0.1.0 - 2016-08-09
* https://github.com/RodrigoBalest/bs-combogrid
* Copyright (c) 2016 Rodrigo Balest; Licensed MIT */
!function(a){function b(b,d){var e=this;this.$el=a(b),this.config=a.extend(!0,{},a.fn.bs_combogrid.defaults,d),this.page=1,this.loadResultsPage=function(b,d){var f={length:void 0===d?this.config.length:d,start:void 0===b?0:b};f[e.$el.attr("name")]=e.$el.val(),this.config.ajax.data=a.extend(!0,{},this.config.ajax.data,f),this.$el.addClass("cg-loading"),a.ajax(this.config.ajax).always(function(){e.clearContainer(),e.$el.removeClass("cg-loading")}).done(function(a){e.data=a,e.container=new c(e.$el,a)}).fail(function(a){e.container=new c(e.$el,{error:a.status+": "+a.responseText})})},this.goToFirstPage=function(){this.page=1,this.loadResultsPage(0)},this.goToLastPage=function(){var a=Math.ceil(this.data.recordsTotal/this.data.data.length);this.page=a;var b=(a-1)*this.config.length;this.loadResultsPage(b)},this.goToPreviousPage=function(){this.page--,this.page<=0&&(this.page=1);var a=(this.page-1)*this.config.length;this.loadResultsPage(a)},this.goToNextPage=function(){this.page++;var a=Math.ceil(this.data.recordsTotal/this.data.data.length);this.page>a&&(this.page=a);var b=(this.page-1)*this.config.length;this.loadResultsPage(b)},this.clearContainer=function(){void 0!==this.container&&this.container.clear()},this.setUp=function(){this.$el.on("keypress",function(a){var b=a.keyCode?a.keyCode:a.which;13===b&&(e.page=1,e.loadResultsPage())})},this.setUp()}function c(b,c){function f(b){var c=[];c.push(h.$el),c.push(h.container),a.each(c,function(c,d){a(d).is(b.target)||0!==a(d).has(b.target).length||(h.clear(),a(document).off("click",f))})}function g(a){var b=a.keyCode?a.keyCode:a.which;27===b&&h.clear()}var h=this;this.$el=a(b),this.data=c;var i=this.$el.data("bs_combogrid");this.setUp=function(){var b=h.$el.offset();b.top=b.top+h.$el.outerHeight(),this.container=a("<div />").attr({id:h.$el.attr("id")+"-cg-container","class":"cg-container panel panel-default"}).css({top:b.top,left:b.left}).insertAfter(h.$el),this.setUpEvents()},this.setContents=function(){this.data.hasOwnProperty("error")||a.isArray(this.data.data)?this.data.error?this.showMessage(this.data.error,"danger"):0===this.data.recordsTotal||0===this.data.data.length?this.showMessage(i.config.emptyMessage,"warning"):(this.table=new d(this.$el,this.data,this.container),"number"==typeof this.data.recordsTotal&&this.data.recordsTotal>this.data.data.length&&(this.paginator=new e(this.$el,this.data,this.container))):this.showMessage("Server must return an array of data or an error message","danger")},this.showMessage=function(a,b){b="undefined"!=typeof b?b:"info",this.container.addClass("alert alert-"+b).text(a)},this.clear=function(){delete this.table,delete this.paginator,this.container.remove()},this.setUpEvents=function(){a(document).on("click",f),this.$el.on("keypress",g)},this.setUp(),this.setContents()}function d(b,c,d){var e=this;this.$el=a(b),this.data=c,this.$container=a(d);var f=this.$el.data("bs_combogrid");this.setUp=function(){var b=a("<table />").addClass("table table-hover"),c=b.append("<tbody />").find("tbody");for(var d in this.data.data){var e=a("<tr />"),f=this.data.data[d];for(var g in f)a("<td />").text(f[g]).appendTo(e);e.data(f).appendTo(c)}b.appendTo(this.$container),this.$table=b,this.setUpListeners()},this.setUpListeners=function(){this.$table.on("click","tr",function(){f.config.onItemSelect.call(e.$el,a(this).data())})},this.setUp()}function e(b,c,d){this.$el=a(b),this.data=c,this.$container=a(d),this.config={firstLabel:'<span class="glyphicon glyphicon-fast-backward"></span>',previousLabel:'<span class="glyphicon glyphicon-backward"></span>',nextLabel:'<span class="glyphicon glyphicon-forward"></span>',lastLabel:'<span class="glyphicon glyphicon-fast-forward"></span>'};var e=this.$el.data("bs_combogrid"),f=Math.ceil(c.recordsTotal/e.config.length),g=e.page;this.setUp=function(){var b=a('<nav class="panel-footer">  <ul class="pager">    <li class="previous pFirst"><a href="#">'+this.config.firstLabel+'</a></li>    <li class="previous pPrev"><a href="#">'+this.config.previousLabel+'</a></li>    <li><span class="pagerCounter">'+g+"/"+f+'</span></li>    <li class="next pLast"><a href="#">'+this.config.lastLabel+'</a></li>    <li class="next pNext"><a href="#">'+this.config.nextLabel+"</a></li>  </ul></nav>");1>=g&&b.find(".pFirst, .pPrev").addClass("disabled"),g>=f&&b.find(".pLast, .pNext").addClass("disabled"),this.$container.append(b),this.$pager=b,this.setUpListeners()},this.setUpListeners=function(){this.$pager.on("click",function(b){var c=a(b.target).parents("li").first();b.preventDefault(),c.hasClass("pFirst")?g>1&&e.goToFirstPage():c.hasClass("pPrev")?g>1&&e.goToPreviousPage():c.hasClass("pLast")?f>g&&e.goToLastPage():c.hasClass("pNext")&&f>g&&e.goToNextPage()})},this.setUp()}a.fn.bs_combogrid=function(c){return this.each(function(){var d=a(this);d.data("bs_combogrid")||d.data("bs_combogrid",new b(this,c))})},a.fn.bs_combogrid.defaults={length:10,emptyMessage:"No results were found",ajax:{},onItemSelect:function(b){var c=a(this);void 0!==typeof b[c.attr("name")]&&c.val(b[c.attr("name")])}}}(jQuery);