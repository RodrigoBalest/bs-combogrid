/*! Bootstrap Combogrid - v2.1.0 - 2019-10-18
* https://github.com/RodrigoBalest/bs-combogrid
* Copyright (c) 2019 Rodrigo Balest; */

!function(t){function a(a,e){function i(a){n.$el.is(a.target)||n.container.find(".page-link").is(a.target)||(n.clear(),t(document).off("click",i))}function s(t){27===(t.keyCode?t.keyCode:t.which)&&n.clear()}var n=this;this.$el=t(a),this.data=e;var o=this.$el.data("bs_combogrid");this.setUp=function(){var a=n.$el.position();a.top=a.top+n.$el.outerHeight(),this.container=t("<div />").attr({id:n.$el.attr("id")+"-cg-container",class:"cg-container card"}).css({top:a.top,left:a.left}).insertAfter(n.$el),o.config.containerWidth&&this.container.css("width",o.config.containerWidth);var e=document.documentElement.clientHeight-(this.container.offset().top-t(window).scrollTop());this.container.css({maxHeight:e,overflow:"auto"}),this.setUpEvents()},this.setContents=function(){this.data.hasOwnProperty("error")||t.isArray(this.data.data)?this.data.error?this.showMessage(this.data.error,"danger"):0===this.data.recordsTotal||0===this.data.data.length?this.showMessage(o.config.emptyMessage,"warning"):(this.table=new function(a,e,i){var s=this;this.$el=t(a),this.data=e,this.$container=t(i);var n=this.$el.data("bs_combogrid"),o=n.config.colModel instanceof Object;this.setUp=function(){var a=t("<table />").addClass("table").addClass(n.config.tableClass);if(o){var e=t("<thead />"),i=e.append("<tr />").find("tr");for(var s in n.config.colModel)t("<th />").text(n.config.colModel[s]).appendTo(i);e.appendTo(a)}!function(a,e){var i=a.append("<tbody />").find("tbody");for(var s in e){var r=t("<tr />"),l=e[s];if(o)for(var h in n.config.colModel)t("<td />").text(l[h]).appendTo(r);else for(var c in l)t("<td />").text(l[c]).appendTo(r);r.data(l).appendTo(i)}}(a,this.data.data),a.appendTo(this.$container),this.$table=a,this.setUpListeners()};this.setUpListeners=function(){this.$table.on("click","tr",function(){n.config.onItemSelect.call(s.$el,t(this).data())})},this.setUp()}(this.$el,this.data,this.container),"number"==typeof this.data.recordsTotal&&this.data.recordsTotal>this.data.data.length&&(this.paginator=new function(a,e,i){this.$el=t(a),this.data=e,this.$container=t(i),this.config={firstLabel:"⏪",previousLabel:"◀",nextLabel:"▶",lastLabel:"⏩"};var s=this.$el.data("bs_combogrid"),n=Math.ceil(e.recordsTotal/s.config.length),o=s.page;this.setUp=function(){var a=t('<nav class="card-footer">  <ul class="pagination pagination-sm justify-content-center mb-0">    <li class="page-item previous pFirst"><a class="page-link" href="#">'+this.config.firstLabel+'</a></li>    <li class="page-item previous pPrev"><a class="page-link" href="#">'+this.config.previousLabel+'</a></li>    <li class="page-item disabled"><span class="pagerCounter page-link">'+o+"/"+n+'</span></li>    <li class="page-item next pNext"><a class="page-link" href="#">'+this.config.nextLabel+'</a></li>    <li class="page-item next pLast"><a class="page-link" href="#">'+this.config.lastLabel+"</a></li>  </ul></nav>");o<=1&&a.find(".pFirst, .pPrev").addClass("disabled"),o>=n&&a.find(".pLast, .pNext").addClass("disabled"),this.$container.append(a),this.$pager=a,this.setUpListeners()},this.setUpListeners=function(){this.$pager.on("click",function(a){var e=t(a.target).parents("li").first();a.preventDefault(),e.hasClass("pFirst")?o>1&&s.goToFirstPage():e.hasClass("pPrev")?o>1&&s.goToPreviousPage():e.hasClass("pLast")?o<n&&s.goToLastPage():e.hasClass("pNext")&&o<n&&s.goToNextPage()})},this.setUp()}(this.$el,this.data,this.container))):this.showMessage("Server must return an array of data or an error message","danger")},this.showMessage=function(t,a){a=void 0!==a?a:"info",this.container.addClass("alert alert-"+a).text(t)},this.clear=function(){delete this.table,delete this.paginator,this.container.remove()},this.setUpEvents=function(){t(document).on("click",i),this.$el.on("keypress",s)},this.setUp(),this.setContents()}t.fn.bs_combogrid=function(e){return this.each(function(){var i=t(this);i.data("bs_combogrid")||i.data("bs_combogrid",new function(e,i){var s=this;this.$el=t(e),this.config=t.extend(!0,{},t.fn.bs_combogrid.defaults,i),this.page=1,this.loadResultsPage=function(e,i){var n={length:void 0===i?this.config.length:i,start:void 0===e?0:e};n[s.$el.attr("name")]=s.$el.val(),this.config.ajax.data=t.extend(!0,{},this.config.ajax.data,n),this.$el.addClass("cg-loading"),t.ajax(this.config.ajax).always(function(){s.clearContainer(),s.$el.removeClass("cg-loading")}).done(function(t){s.data=t,s.container=new a(s.$el,t)}).fail(function(t){s.container=new a(s.$el,{error:t.status+": "+t.responseText})})},this.goToFirstPage=function(){this.page=1,this.loadResultsPage(0)},this.goToLastPage=function(){var t=Math.ceil(this.data.recordsTotal/this.data.data.length);this.page=t;var a=(t-1)*this.config.length;this.loadResultsPage(a)},this.goToPreviousPage=function(){this.page--,this.page<=0&&(this.page=1);var t=(this.page-1)*this.config.length;this.loadResultsPage(t)},this.goToNextPage=function(){this.page++;var t=Math.ceil(this.data.recordsTotal/this.data.data.length);this.page>t&&(this.page=t);var a=(this.page-1)*this.config.length;this.loadResultsPage(a)},this.clearContainer=function(){void 0!==this.container&&this.container.clear()},this.setUp=function(){this.$el.on("keypress",function(t){13===(t.keyCode?t.keyCode:t.which)&&s.goToFirstPage()}),this.config.searchButton&&t(document).on("click",this.config.searchButton,function(t){t.preventDefault(),s.goToFirstPage()})},this.setUp()}(this,e))})},t.fn.bs_combogrid.defaults={length:10,emptyMessage:"No results were found",ajax:{},searchButton:!1,onItemSelect:function(a){var e=t(this);void 0!==typeof a[e.attr("name")]&&e.val(a[e.attr("name")])},tableClass:"mb-0 table-hover table-sm",containerWidth:null}}(jQuery);